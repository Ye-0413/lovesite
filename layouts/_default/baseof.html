<!doctype html>
<html lang="{{ .Site.LanguageCode }}">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      id="viewport"
      content="width=device-width, initial-scale=1.0" />
    <title>
      {{ block "title" . }}
        {{- if .IsHome -}}
          {{ .Site.Title }}
        {{- else -}}
          {{ if .Data.Plural }}
            {{ .Title }} - {{ .Data.Plural }} |
            {{ .Site.Title }}
          {{ else }}
            {{ .Type }} |
            {{ .Site.Title }}
          {{ end }}
        {{- end -}}
      {{ end }}
    </title>

    {{- partial "head/meta.html" . -}}
    {{- block "extra_meta" . }}{{- end }}
    {{- partial "head/hook_before_link.html" . -}}
    {{- partial "head/link.html" . -}}
    {{- partial "head/font_link.html" . -}}
    {{- block "extra_link" . }}{{- end }}
    {{- partial "head/hook_after_link.html" . -}}
    {{- partial "head/script.html" . -}}
    {{- block "extra_script". }}{{- end }}


    <style>
      [x-cloak] {
        display: none !important;
      }
    </style>
  </head>

  <body
    x-cloak
    x-data="{ 
      shrink: false,
      bgAni: $store.darkMode.on && {{ .Site.Params.background.enableBgAnimate | default true }},
      scrollY: 0,
      darkImg: '{{ .Site.Params.background.darkImg }}',
      bgOpen: {{ .Site.Params.background.enable }},
      newbgImg: '',
      bgImg: '',

      init() {
        if (this.bgOpen && $store.darkMode.on) {
          bgImg = '{{ .Site.Params.background.darkImg }}'
        } else if (this.bgOpen && !$store.darkMode.on) {
          bgImg = '{{ .Site.Params.background.lightImg }}'
        } else {
          bgImg = ''
        }

        console.log('init dark mode: ' + $store.darkMode.on)
      },

      get bgImg () {
        return bgImg
      },

      set bgImg(v) {
        bgImg = v;
      },

      getNewBgImg() {
        return bgImg;
      },
    }"
    x-init="$watch('$store.darkMode.on', (value) => {
      if (value && bgOpen) {
        bgImg = '{{ .Site.Params.background.darkImg }}'
      } else if (!value && bgOpen) {
        bgImg = '{{ .Site.Params.background.lightImg }}'
      }

      bgAni = value && {{ .Site.Params.background.enableBgAnimate | default true }}
    })"
    @click="newbgImg = getNewBgImg()"
    @scroll.window="shrink = (window.scrollY > 10 ? true : false)"
    x-effect="$el.style.backgroundImage = 'url(' + bgImg + ')'"
    :style="'background-image: ' + 'url(' + newbgImg + ')'"
    :class="{'bg-white': !bgOpen, 'dark:bg-gray-900': !bgOpen, 'bg-cover': bgOpen, 'bg-fixed': bgOpen, 'dark:delay-300': bgAni }"
    class="flex h-screen flex-col scroll-auto">
    <div
      x-show="bgAni"
      x-cloak
      x-effect="console.log('dark ani: ' + bgAni)"
      x-transition:enter="animate-bgScaleInTr"
      x-transition:leave="animate-bgScaleOutTr"
      :style="'background-image: ' + 'url(' + darkImg + ')'"
      :class="{'bg-gray-900': !bgOpen,'dark:bg-gray-900': !bgOpen, 'bg-cover': bgOpen, 'bg-fixed': bgOpen}"
      class="fixed left-0 top-0 -z-10 h-full w-full"></div>

    {{- partial "header/header.html" . -}}

    {{- block "main" . }}{{- end }}

    {{ if .Site.Params.enableSearch }}
      {{- partial "search.html" . -}}
    {{ end }}

    {{- partial "footer/footer.html" . -}}

    {{- block "script" . }}{{- end }}
    {{- partial "analytics.html" . -}}
  </body>
</html>
